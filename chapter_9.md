# 9장 전방 탐색과 후방 탐색

지금까지는 모두 일치하는 텍스트에 대해서 말했지만, 이번 장에서는 텍스트 자체를 찾는 것이라 아니라 어디서 찾을 것인지를 표시하는데 사용할 전후방탐색(lookaround)를 알아보겠습니다. 참고로 전방 탐색은 거의 모두 지원하지만 후방 탐색은 지원하지 않는 경우도 많습니다. 참고하세요.

## 전후방탐색 살펴보기

아래 예제를 살펴봅시다.

```html
<HEAD>
<TITLE>Ben Forta's Homepage</TITLE>
</HEAD>
```

이것은 `ex/9_1.html`에 들어 있습니다. 다음과 같이 확인하면 됩니다.

```bash
bat ex/9_1.html
```

여기서 `TITLE` 태그 안에 들어 있는 것만 찾으려고 합니다. 지금까지 배운 것을 토대로 패턴을 만들면 다음과 같습니다.

```re
rg '<[Tt][Ii][Tt][Ll][Ee]>.*<\/[Tt][Ii][Tt][Ll][Ee]>' ex/9_1.html
```

```re
grep '<[Tt][Ii][Tt][Ll][Ee]>.*<\/[Tt][Ii][Tt][Ll][Ee]>' ex/9_1.html
```

실행 결과는 다음과 같습니다.

```bash
rg '<[Tt][Ii][Tt][Ll][Ee]>.*<\/[Tt][Ii][Tt][Ll][Ee]>' ex/9_1.html

2:    <TITLE>Ben Forta's Homepage</TITLE>

grep '<[Tt][Ii][Tt][Ll][Ee]>.*<\/[Tt][Ii][Tt][Ll][Ee]>' ex/9_1.html

    <TITLE>Ben Forta's Homepage</TITLE>
```

그러나 우리는 `Ben Forta's Homepage`만 필요합니다. 이때 필요한 것은 전후방탐색입니다.

## 전방 탐색 - 앞으로 찾기

전방탐색(lookahead) 패턴은 패턴에 일치하는 영역을 발견해도 그 값을 반환하지 않는 패턴입니다. 전방탐색은 실제로는 하위 표현식이 때문에, 전방 탐색 구분은 `?=`으로 시작하며 앞의 등호 `=` 다음에 일치할 텍스트가 오는 하위 표현식입니다. 다음 예제를 살펴봅시다.

```text
http://www.forta.com/
https://mail.forta.com/
ftp://ftp.forta.com/
```

이것은 `ex/9_2.txt`에 들어 있습니다. 다음과 같이 확인하면 됩니다.

```bash
bat ex/9_2.txt
```

여기서 우리는 주소 앞에서 있는 `http`과 같은 프로토콜을 알고 싶다고 해봅시다.

```re
rg '.+:' ex/9_2.txt
```

```re
grep '.+:' ex/9_2.txt -E
```

윗 코드들은 모두 `http:`과 같이 `:`을 포함한 결과를 반환합니다. 여기서는 `:`을 중심으로 앞에 있는 모든 텍스트를 찾게 되어 있습니다. 그러나 여기서는 `:`를 포함해서 찾고 있습니다. 이를 '소비한다(consume)'고 말합니다. 그러면 `:`를 '소비하지 않고(not consume)', 즉 포함하지 않고 찾을 때 필요한 것이 전방탐색입니다. 아래 코드를 실행해 봅시다. 참고로 `grep`은 적절하게 전방탐색을 할 수 없어 제외했습니다.

```re
rg '.+(?=:)' ex/9_2.txt --pcre2
```

참고로 `rg`에서 역참조를 사용하기 위해서는 `--pcre2`을 옵션으로 선택해야 합니다.

윗 코드를 실행하면 `:`을 제외하고, 다시 말해 소비하지 않고, 그 앞에 있는 문자열을 찾기 때문에 우리가 의도한 것과 같이 `http`과 같이 찾는 것을 확인할 수 있습니다.

## 후방탐색 - 뒤로 찾기

앞에서 설명한 전방탐색은 `?=`이라는 전방탐색 연산자를 사용해서, 검색할 것은 소비하지 않고 앞으로 탐색한다. 후방탐색(lookbehind)는 `?<=`를 후방탐색 연사자로 사용하여 텍스트를 반환하기 전에 뒤쪽을 탐색한다. 아래 예제를 살펴봅시다.

```txt
ABC01: $23.45
HGG42: $5.31
CFMX1: $899.00
XTC99: $69.96
Total items found: 4
```

이것은 `ex/9_3.txt`에 들어 있습니다. 다음과 같이 확인하면 됩니다.

```bash
bat ex/9_3.txt
```

여기서 가격만 뽑는 패턴이 필요합니다. 쉽게 `$` 이후에 나오는 `.` 포함 숫자를 뽑은 패턴을 다음과 같이 만들면 됩니다.

```re
rg '\$[0-9.]+' ex/9_3.txt
```

```re
grep '\$[0-9.]+' ex/9_3.txt -E
```

그러나 윗 패턴은 `$`을 소비하고 있기 때문에 검색 결과에 포함되어 버립니다. 이를 해결하기 위해서 필요한 것은 후방탐색입니다.

```re
rg '(?<=\$)[0-9.]+' ex/9_3.txt  --pcre2
```

위와 같이 후방탐색 연산자를 사용하면 `$`을 가지고 검색하지만 소비하지 않고 앞에서 `$`을 제외한 숫자만 반환합니다.
