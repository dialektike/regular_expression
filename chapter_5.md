# 4장 반복 찾기

이번 장에서는 여러번 반복해 나타나는 문자나 문자 집합을 어떻게 찾는지 알아보겠습니다.

## 몇 번 일치하는가?

지금까지 공부한 것을 토대로 이메일 주소와 일치하는 패턴을 찾아봅시다. 이메일의 기본 형식은 다음과 같습니다.

```text
text@text.text
t@t.t
```

이것은 `ex/5_1.txt`에 들어 있습니다. 다음과 같이 확인하면 됩니다.

```bash
bat ex/5_1.txt
```

앞에서 배운 것을 토대로 이메일을 주소를 찾기 위해서 다음과 같은 패턴을 만들 수 있습니다.

- 정규 표현식: `\w@\w\.\w`

이 정규 표현식을 사용해봅시다.

```bash
rg '\w@\w\.\w' ex/5_1.txt
```

우리가 예상한 것은 이메일 전체 문장을 다 선택해 주기를 원했지만 위의 코드를 실행하면, 2번째 줄인 `t@t.t`을 찾은 것을 확인할 수 있습니다. 왜냐하면 위의 정규표현식은 단지 아래와 같이 1 글자씩만 있는 것에만 일치하고 있기 때문입니다. 다시 말해 `\w`은 문자 1개만 일치하는 패턴이기 때문입니다. 그렇기 때문에 1번째 줄을 이메일 주소 전체를 정확하게 선택하지 못하고 2번째 줄은 정확하게 선택하고 있습니다. 아래 코드를 실행하면 정확하게 이해할 수 있습니다.

```bash
echo "text@text.text" | rg '\w@\w\.\w'
```

윗 코드에서 앞의 문자열에서 아무 것도 찾지 못 하고 있는 것을 알 수 있습니다.

### 문자 하나 이상 찾기

그러면 앞에서 한 문자가 아니라 `@`앞에 있는 문자열, `@`과 `.` 사이에 있는 문자열, `.` 뒤에 있는 문자열, 즉 여러 개의 문자열을 찾으려면 어떻게 해야 할까요? 하나 이상의 문자열을 찾기 위해서는 문자 뒤에 `+`를 븉이면 됩니다. 예를 들어 `a`는 `a`라는 한 글자를 찾지만 `a+`는 하나 이상 `a`가 연속적으로 있는 것을 찾습니다. 그리고 `[0-9]`는 숫자 1개를 찾지만, `[0-9]+`은 하나 이상 숫자가 연속적으로 있는 것을 찾습니다. 참고로 `[0-9+]`과 같이 하면 다른 결과가 나오게 됩니다. 이 패턴을 단순히 이야기하면 `[0,1,2,3,4,5,6,7,8,9,+]`와 일치하는 것을 찾는 패턴입니다. 참고로 `+` 문자를 찾으려고 한다면, 이스케이프 문자를 포함한 `\+`을 이용하면 됩니다.

- 정규 표현식: `+`: 하나 이상을 찾는다, 보기: `[0-9]+`, `w+`

다음과 같이 이메일 주소가 들어 있는 문자열에서 이메일 주소를 찾아보겠습니다.

```text
Send personal email to ben@forta.com. For questions about a book use support@forta.com. Feel free to send unsolicited email to spam@forta.com(wouldn't it be nice if it were that simple, huh?).
```

이것은 `ex/5_2.txt`에 들어 있습니다. 다음과 같이 확인하면 됩니다.

```bash
bat ex/5_2.txt
```

그러면 위에서 만든 패턴을 이용해 봅시다.

```bash
rg '\w+@\w+\.\w+' ex/5_2.txt
```

적정하게 찾는 것을 확인할 수 있습니다. 다음 예제에도 위의 패턴을 적용해 봅시다.

```txt
Send personal email to ben@forta.com or ben.forta@forta.com. For questions about a book use support@forta.com. If your message is urgent try ben@urgent.forta.com. Feel free to send unsolicited email to spam@forta.com (wouldn't it be nice if it were that simple, huh?).
```

이것은 `ex/5_3.txt`에 들어 있습니다. 다음과 같이 확인하면 됩니다.

```bash
bat ex/5_3.txt
```

그러면 위에서 만든 패턴을 이용해 봅시다.

```bash
rg '\w+@\w+\.\w+' ex/5_3.txt
```

이 패턴은 `ex/5_3.txt`에 들어 있는 5개의 이메일 주소 중 3개는 정확하게 찾지만, 아래 나머지 2개는 정확하게 찾지 못하고 있습니다.

1. `ben.forta@forta.com`
2. `ben@urgent.forta.com`

이 두 이메일 주소는 `@` 앞 뒤 주소에 `.`이 들어 있는 경우입니다. 이를 위의 패턴은 정확하게 찾지 못 하고 있습니다. 이를 해결하려면 문자와 `.`을 동시에 찾아야 할 것 같습니다. 문자 집합, `\w`과 `.`을 합친 `[\w.]`을 사용해 봅시다.

```bash
rg '[\w.]+@[\w.]+\.\w+' ex/5_3.txt
```

여기서 조심해 부분이 있습니다. 마지막 부분의 `\w+`을 다음과 같이 굳이 `[\w.]+`으로 바꿀 필요는 없을 것 같습니다.

```bash
rg '[\w.]+@[\w.]+\.[\w.]+' ex/5_3.txt
```

이렇게 하면 마지막에 있는 마침표(`.`)같이 검색되는 경우가 있습니다.

### 문자가 없는 경우나 하나 이상 연속하는 문자 찾기

메타 문자, `+`는 하나 이상 연속된 문자를 찾습니다. 그러나 문자가 없는 경우에는 찾지 못 하고 최소한 하나는 일치해야 합니다. 그래서 있을 수도 없을 수도 있는 문자와 일치하는 것을 찾으려고 한다면 메타 문자 `*`을 사용해야 합니다. 만약 아래 코드처럼 메타 문자 `.`만 사용한다면 뒤에 'B. Forta', 'Ben Forta'은 찾을 수 없습니다.

```bash
echo "B Forta, B. Forta, Ben  Forta" | rg 'B.Forta'
```

그러나 아래와 같이 `*`을 사용한다면 모두 선택하게 됩니다.

```bash
echo "B Forta, B. Forta, Ben  Forta" | rg 'B.*Forta'
```

이제 앞에서 살펴 봤던 이메일 주소 관련 문제로 돌아와 봅시다. 다음 문자열을 봅시다.

```txt
Hello .ben@forta.com is my email address.
```

이것은 `ex/5_4.txt`에 들어 있습니다. 다음과 같이 확인하면 됩니다.

```bash
bat ex/5_4.txt
```

그러면 위에서 만든 패턴을 이용해서 윗 문자열에서 이메일 주소를 찾아 봅시다.

```bash
rg '[\w.]+@[\w.]+\.\w+' ex/5_4.txt
```

앞에서도 말했지만 `[\w.]+`는 아무 문자(`\w`)나 `.`이 하나 이상 있는 것을 찾는 것입니다. 그러므로 이메일 주소 맨 앞에 있는 `.`도 함께 포함해서 일치한다고 검색하게 되는 것입니다. 정확하게 `.`을 제외할 수 있는 패턴이 필요합니다. 다시 말해서 따라서 맨 앞 글자는 순전히 문자만 찾는 패턴이 되어야 합니다. 첫 문자는 순전히 영문자나 숫자만 있는 문자열을 찾는 패턴은 `\w+`입니다. 그리고 두 번째 문자부터는 아무 문자나 와도 상관이 없습니다.

```bash
rg '\w+[\w.]+@[\w.]+\.\w+' ex/5_4.txt
```

아주 정확하게 이메일 주소를 찾고 있습니다. 그러나 아쉽게도 윗 패턴의 문제점은 다음과 같이 맨 앞이 한 글자로 되어 있는 것을 찾을 수 없다는 점입니다. 정확하게 말하자면 윗 패턴은 두 글자 이상 있는 것만 찾을 수 있는 패턴입니다. 다음 코드를 실행하면 정확하게 알 수 있습니다.

```bash
echo "a@forta.com" | rg '\w+[\w.]+@[\w.]+\.\w+'
```

위의 코드를 사용하면 `a@forta.com`을 찾지 못 합니다. 이를 해결하기 위해서는 두 번째 문자 이상을 찾는 `[\w.]+`에서 `+`을 `[\w.]*`과 같이 `*`으로 바꾸면 됩니다.

```bash
echo "a@forta.com" | rg '\w+[\w.]*@[\w.]+\.\w+'
```

위의 패턴은 정확하게 `a@forta.com`을 찾습니다. 왜냐하면 두 번째 문자 이상을 찾는 `[\w.]₩`에서 `*`은 해당 문자가 있어서도 되고 없어도 되기 때문에, 다시 말해 만드시 있을 필요가 없기 때문입니다.
