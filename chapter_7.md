# 6장 하위 표현식 사용하기

이번 장에서는 '하위 표현식(Subexpression)'을 사용해 여러 표현식을 어떻게 묶는지 알아보겠습니다.

## 하위 표현식 이해하기

5장에서는 단어 하나 하나가 여러 번 일치하는 경우를 살펴봤습니다. 이때 `https?://`은 `https://`과 `http://`에 모두 적용되는 패턴인데 이는 반복 메타 문자를 자기 바로 앞에 있는 문자나 메타 문자에 적용하는 방법입니다. 예를 들어 `HTML`을 코딩하는 경우는 단어 사이의 강제 공백을 확실히 하기 위해 강제 공백(nonbreaking space), 즉 `&nbsp;`을 아래와 같이 사용하는 경우가 있습니다.

```html
Hello, my name is Ben&bsp; Forta, and I am the author of books on SQL, ColdFusion, WAP, Windows&bsp;&bsp;2000, and other subjects.
```

이것은 `ex/7_1.html`에 들어 있습니다. 다음과 같이 확인하면 됩니다.

```bash
bat ex/7_1.html
```

여기서 `&bsp;`을 두 번 반복해서 사용한 것을 찾아 제거하고자 합니다. `&bsp;{2,}`을 사용해 `&bsp;`이 `{2,}`, 즉 두 번 이상 나온 것을 찾는 것이라고 생각해 코드를 작성해 봅시다.

```bash
rg '&bsp;{2,}' ex/7_1.html
```

그러나 앞의 코드를 실행하면 앞에서 의도대로 패턴이 작동하지 않은 것을 확인할 수 있습니다. 앞의 코드는 정확하게 말하자면 `;`을 '두 번(`{2,}`)' 이상 반복한 것을 찾아라고 한 것입니다. 그러므로 `&bsp;`을 2번 이상 반복한 것을 찾는 패턴으로는 적절하지 않습니다.

## 하위 표현식으로 묶기

위의 문제를 해결하기 위해서는 하위 표현식이 필요합니다. 하위 표현식은 큰 표현식 안에 속한 일뷰 표현식을 한 항목으로 다루도록 한꺼번에 괄호(`(,)`)로 묶은 것입니다.

```bash
rg '(&bsp;){2,}' ex/7_1.html
```

**Tip**: 괄호는 당연히 메타 문자이기 때문에 만약 괄호를 찾으려면 `\`을 사용하면 됩니다.

아래 예제에서 정규 표현식으로 IP 주소를 찾아 봅시다. IP 주소는 마침표로 구분된 숫자 네 묶음입니다. 묶음 숫자는 한 자리 숫자부터 3자리 숫자까지 가능합니다.

```txt
Pinging hog.forta.com [12.159.46.200] with 32 bytes of data:
```

이것은 `ex/7_2.txt`에 들어 있습니다. 다음과 같이 확인하면 됩니다.

```bash
bat ex/7_2.txt
```

1자리부터 3자리 숫자라면 `\d{1,3}`이고 이것이 마침표로 구분되어 있으면서 4개가 나오는 것이기 때문에 다음과 같이 하면 됩니다.

```bash
rg '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}' ex/7_2.txt
```

위와 같이 해도 잘 작동하지만, 반복을 하위 표현식을 이용해서 반복을 아래와 같이 줄일 수 있습니다.

```bash
rg '(\d{1,3}\.){3}\d{1,3}' ex/7_2.txt
```

그러나 단순하게 생각해서 아래와 같이 4번 반복한다고 생각해서는 안 됩니다.

```bash
rg '(\d{1,3}\.){4}' ex/7_2.txt
```

왜냐하면 마지막 숫자 뒤에는 마침표가 없기 때문이다.
